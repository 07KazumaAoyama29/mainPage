{# templates/todo/partials/task_list_and_progress.html #}

{# --- プログレスバー --- #}
<div class="mb-4" id="progress-container">
  <h5>進捗 ({{ completed_tasks }} / {{ total_tasks }})</h5>
  <div class="progress">
    <div class="progress-bar" role="progressbar" style="width: {{ progress_percentage }}%;" aria-valuenow="{{ progress_percentage }}" aria-valuemin="0" aria-valuemax="100">
      {{ progress_percentage|floatformat:0 }}%
    </div>
  </div>
</div>

{# --- 新規タスク作成フォーム --- #}
<form method="post" action="{% url 'todo:schedule_detail' pk=schedule.pk %}" class="mb-4" id="add-task-form">
  {% csrf_token %}
  <div class="input-group">
    {{ form.title }}
    <button class="btn btn-primary" type="submit">タスクを追加</button>
  </div>
</form>

{# --- タスク一覧 --- #}
<h4 class="mt-4">タスクリスト</h4>
<div id="task-list-container">
  {% if tasks %}
    <ul class="list-group">
      {% for task in tasks %}
        <li class="list-group-item d-flex justify-content-between align-items-center">
          <span class="{% if task.completed %}text-muted text-decoration-line-through{% endif %}">
            {{ task.title }}
          </span>
          {# --- チェックボックスのフォーム --- #}
          <form hx-post="{% url 'todo:toggle_task' pk=task.pk %}"
                hx-target="#task-section"
                hx-swap="innerHTML">
            {% csrf_token %}
            <input type="checkbox" class="form-check-input" 
                   onchange="this.form.requestSubmit()" 
                   {% if task.completed %}checked{% endif %}>
          </form>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p>このスケジュールにはまだタスクがありません。</p>
  {% endif %}
</div>